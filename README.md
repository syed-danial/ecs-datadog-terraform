# terraform-ltk-ecs
Repository that provisions all Amazon ECS resources related to the LTK services

## Table of Contents
1. [How to Trigger Workflows](#how-to-trigger-workflows)
    - [Terraform & Semantic Operations Workflow](#terraform--semantic-operations-workflow)
    - [Terraform Operations Workflow](#terraform-operations-workflow)
    - [Semantic Release Workflow](#semantic-release-workflow)


## Related Repositories
- [terraform-networking-lendertoolkit](https://github.com/LenderToolkit/terraform-networking-lendertoolkit):
Provisions all network related AWS services such as AWS VPC and subnets.
- [terraform-ltk-shared-infrastructure](https://github.com/LenderToolkit/terraform-ltk-shared-infrastructure):
Provisions all shared infrastructure resources in the shared-infra AWS account such as AWS ECR.
- [terraform-ltk-data](https://github.com/LenderToolkit/terraform-ltk-data):
Provisions all data related AWS services such as Amazon Aurora, Amazon RDS, and Amazon ElastiCache.


## Prerequisites
- Node v18 and higher
- Run `npm install`

## How to Trigger Workflows

### Terraform & Semantic Operations Workflow

This workflow is triggered on push to the `main`, `dev`, `stage`, and `prod` branches.

#### Steps to Trigger
1. Make the required changes to the code base.
2. Commit the changes.
   - run `git add .`
   - run `npx cz` and follows prompts. Fix and feature triggers semantic release.
3. Push the committed changes to one of the above-mentioned branches.
   - run `git push`

#### What it Does
- On push to `dev` branch, it runs Terraform plan and apply for development environment with specific dev.tfvars and triggers semantic release.
- On push to `stage` branch, it runs Terraform plan and apply for staging environment with specific stage.tfvars and triggers semantic release.
- On push to `prod` branch, it runs Terraform plan and apply for production environment with specific prod.tfvars and triggers semantic release.

### Terraform Operations Workflow

This workflow is designed to be called by other workflows.

#### How to Configure
The calling workflow must provide the following inputs:
- `tfvars-path`: Path to the tfvars file
- `tf-apply`: Boolean to run apply
- `tf-workspace`: Terraform workspace to use
- `role-to-assume`: AWS IAM Role ARN for the infra worker role
- `run-semantic-release`: Boolean to run semantic release
- `only-plan`: Boolean to run only terraform plan (Optional, Default: false)
- `token`: Secret Token (Required)

#### What it Does
- If `run-semantic-release` is true, it triggers the Semantic Release Workflow and then runs either Terraform Plan or Apply based on provided inputs.
- If `only-plan` is true, it only performs Terraform Plan.

### Semantic Release Workflow

This workflow is designed to be called by other workflows.

#### How to Configure
The calling workflow must provide the following inputs:
- `persist-creds`: Persist credentials (Optional, Default: true)
- `token`: Secret Token (Required)

#### What it Does
- Sets up Node.js
- Installs dependencies
- Runs semantic release and calculates the next version tag

## ALB Access

Lower env alb ingress access is managed via the local variable lower_env_alb_ingress_cidr_blocks (found in locals.tf).
Add a new IP to this list to grant access to the internet facing ECS applications.

<!-- BEGIN_TF_DOCS -->
## Requirements

| Name                                                                      | Version  |
|---------------------------------------------------------------------------|----------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 1.5.4 |
| <a name="requirement_aws"></a> [aws](#requirement\_aws)                   | 5.11.0   |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_aws"></a> [aws](#provider\_aws) | 5.11.0 |
| <a name="provider_terraform"></a> [terraform](#provider\_terraform) | n/a |

## Modules

| Name                                                                                                                                                  | Source                                   | Version |
|-------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|---------|
| <a name="module_alb"></a> [alb](#module\_alb)                                                                                                         | terraform-aws-modules/alb/aws            | ~> 8.0  |
| <a name="module_alb_sg"></a> [alb\_sg](#module\_alb\_sg)                                                                                              | terraform-aws-modules/security-group/aws | 5.1.0   |
| <a name="module_internal_alb"></a> [internal\_alb](#module\_internal\_alb)                                                                            | terraform-aws-modules/alb/aws            | ~> 8.0  |
| <a name="module_internal_alb_sg"></a> [internal\_alb\_sg](#module\_internal\_alb\_sg)                                                                 | terraform-aws-modules/security-group/aws | 5.1.0   |
| <a name="module_ecs_sg"></a> [ecs\_sg](#module\_ecs\_sg)                                                                                              | terraform-aws-modules/security-group/aws | 5.1.0   |
| <a name="module_internal_ecs_sg"></a> [internal\_ecs\_sg](#module\_internal\_ecs\_sg)                                                                 | terraform-aws-modules/security-group/aws | 5.1.0   |
| <a name="module_ltk_encompdev_api_autoscaling"></a> [ltk\_encompdev\_api\_autoscaling](#module\_ltk\_encompdev\_api\_autoscaling)                     | ./modules/app_autoscaling                | n/a     |
| <a name="module_ltk_ai_public_licensing_autoscaling"></a> [ltk\_ai\_public\_licensing\_autoscaling](#module\_ltk\_ai\_public\_licensing\_autoscaling) | ./modules/app_autoscaling                | n/a     |
| <a name="module_ltk_api_settings_autoscaling"></a> [ltk\_api\_settings\_autoscaling](#module\_ltk\_api\_settings\_autoscaling)                        | ./modules/app_autoscaling                | n/a     |
| <a name="module_chat_with_docs_autoscaling"></a> [chat\_with\_docs\_autoscaling](#module\_chat\_with\_docs\_autoscaling)                              | ./modules/app_autoscaling                | n/a     |
| <a name="module_ltk_api_events_autoscaling"></a> [ltk\_api\_events\_autoscaling](#module\_ltk\_api\_events\_autoscaling)                              | ./modules/app_autoscaling                | n/a     |
| <a name="module_ltk_monitoring"></a> [ltk\_monitoring](#module\_ltk\_monitoring)                                                                      | ./modules/monitoring                     | n/a     |
| <a name="module_cognito"></a> [cognito](#module\_cognito)                                                                                             | ./modules/cognito                        | n/a     |

## Resources

| Name                                                                                                                                                                          | Type        |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|
| [aws_iam_policy.ecr_policy](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/iam_policy)                                                           | resource    |
| [aws_iam_policy.task_policy](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/iam_policy)                                                          | resource    |
| [aws_iam_policy.s3_access](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/iam_policy)                                                            | resource    |
| [aws_iam_policy.cognito_access](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/iam_policy)                                                       | resource    |
| [aws_secretsmanager_secret.ltk_ai_public_licensing_secret](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/secretsmanager_secret)                 | resource    |
| [aws_secretsmanager_secret_version.ltk_ai_public_licensing_secret](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/secretsmanager_secret_version) | resource    |
| [aws_secretsmanager_secret.ltk_api_settings_secret](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/secretsmanager_secret)                        | resource    |
| [aws_secretsmanager_secret_version.ltk_api_settings_secret](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/secretsmanager_secret_version)        | resource    |
| [aws_secretsmanager_secret.ltk_api_events_secret](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/secretsmanager_secret)                          | resource    |
| [aws_secretsmanager_secret_version.ltk_api_events_secret](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/secretsmanager_secret_version)          | resource    |
| [aws_secretsmanager_secret.chat_with_docs_secret](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/secretsmanager_secret)                          | resource    |
| [aws_secretsmanager_secret_version.chat_with_docs_secret](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/secretsmanager_secret_version)          | resource    |
| [aws_iam_policy.sm_access](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/iam_policy)                                                            | resource    |
| [aws_ecs_cluster.ecs_cluster](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/ecs_cluster)                                                        | resource    |
| [aws_iam_role.ecs_execution_role](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/iam_role)                                                       | resource    |
| [aws_iam_role.ecs_task_role](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/iam_role)                                                            | resource    |
| [aws_s3_bucket.alb_access_logs](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/s3_bucket)                                                        | resource    |
| [aws_s3_bucket_policy.alb_access_logs_policy](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/s3_bucket_policy)                                   | resource    |
| [aws_ecs_cluster_capacity_providers.cluster_capacity_provider](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/ecs_cluster_capacity_providers)    | resource    |
| [aws_cloudwatch_log_group.ltk_encompdev_api_log_group](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/cloudwatch_log_group)                      | resource    |
| [aws_cloudwatch_log_stream.ltk_encompdev_api_log_stream](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/cloudwatch_log_stream)                   | resource    |
| [aws_cloudwatch_log_group.ltk_ai_public_licensing_log_group](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/cloudwatch_log_group)                | resource    |
| [aws_cloudwatch_log_stream.ltk_ai_public_licensing_log_stream](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/cloudwatch_log_stream)             | resource    |
| [aws_cloudwatch_log_group.ltk_api_settings_log_group](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/cloudwatch_log_group)                       | resource    |
| [aws_cloudwatch_log_stream.ltk_api_settings_log_stream](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/cloudwatch_log_stream)                    | resource    |
| [aws_cloudwatch_log_group.chat_with_docs_log_group](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/cloudwatch_log_group)                         | resource    |
| [aws_cloudwatch_log_stream.chat_with_docs_log_stream](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/cloudwatch_log_stream)                      | resource    |
| [aws_cloudwatch_log_group.ltk_api_events_log_group](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/cloudwatch_log_group)                         | resource    |
| [aws_cloudwatch_log_stream.ltk_api_events_log_stream](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/cloudwatch_log_stream)                      | resource    |
| [aws_ecs_task_definition.ltk_encompdev_api_task_definition](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/ecs_task_definition)                  | resource    |
| [aws_ecs_task_definition.ltk_ai_public_licensing_task_definition](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/ecs_task_definition)            | resource    |
| [aws_ecs_task_definition.ltk_api_settings_task_definition](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/ecs_task_definition)                   | resource    |
| [aws_ecs_task_definition.chat_with_docs_task_definition](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/ecs_task_definition)                     | resource    |
| [aws_ecs_task_definition.ltk_api_events_task_definition](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/ecs_task_definition)                     | resource    |
| [aws_ecs_service.ltk_encompdev_api_service](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/ecs_service)                                          | resource    |
| [aws_ecs_service.ltk_ai_public_licensing_service](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/ecs_service)                                    | resource    |
| [aws_ecs_service.ltk_api_settings_service](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/ecs_service)                                           | resource    |
| [aws_ecs_service.chat_with_docs_service](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/ecs_service)                                             | resource    |
| [aws_ecs_service.ltk_api_events_service](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/ecs_service)                                             | resource    |
| [aws_sqs_queue.ltk_webhooks_queue](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/sqs_queue)                                                     | resource    |
| [aws_dynamodb_table.ltk_events](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/dynamodb_table)                                                   | resource    |
| [aws_dynamodb_table.ltk_tasks](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/dynamodb_table)                                                    | resource    |
| [aws_dynamodb_table.ltk_webhook_signing_keys](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/dynamodb_table)                                     | resource    |
| [aws_dynamodb_table.ltk_logging](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/dynamodb_table)                                                  | resource    |
| [aws_s3_bucket.toolshed_bucket](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/s3_bucket)                                                        | resource    |
| [aws_s3_bucket_versioning.toolshed_bucket_versioning](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/s3_bucket_versioning)                       | resource    |
| [aws_s3_bucket.settings_bucket](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/s3_bucket)                                                        | resource    |
| [aws_s3_bucket_versioning.settings_bucket_versioning](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/resources/s3_bucket_versioning)                       | resource    |
| [aws_caller_identity.current](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/data-sources/caller_identity)                                                 | data source |
| [aws_region.current](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/data-sources/region)                                                                   | data source |
| [terraform_remote_state.shared_infra](https://registry.terraform.io/providers/hashicorp/terraform/latest/docs/data-sources/remote_state)                                      | data source |
| [terraform_remote_state.network_data](https://registry.terraform.io/providers/hashicorp/terraform/latest/docs/data-sources/remote_state)                                      | data source |
| [aws_iam_policy.AmazonECSTaskExecutionRolePolicy](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/data-sources/iam_policy)                                  | data source |
| [aws_subnets.public_subnets](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/data-sources/subnets)                                                          | data source |
| [aws_subnets.private_subnets](https://registry.terraform.io/providers/hashicorp/aws/5.11.0/docs/data-sources/subnets)                                                         | data source |

## Inputs

| Name                                                                                                                                 | Description                                                              | Type                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | Default                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | Required |
|--------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:--------:|
| <a name="input_semantic_version"></a> [semantic\_version](#input\_semantic\_version)                                                 | n/a                                                                      | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `""`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |    no    |
| <a name="input_identifier"></a> [identifier](#input\_identifier)                                                                     | Name prefix for the resources                                            | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `""`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |    no    |
| <a name="input_profile_env_kv_map"></a> [profile\_env\_kv\_map](#input\_profile\_env\_kv\_map)                                       | n/a                                                                      | `map(any)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | <pre>{<br>  "shared": "arn:aws:iam::623542229617:role/infra-worker-cross-account-assume-role"<br>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |    no    |
| <a name="input_tags"></a> [tags](#input\_tags)                                                                                       | Tags to be applied to the resource                                       | `map(any)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `{}`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |    no    |
| <a name="input_ltk_encompdev_api_config"></a> [ltk\_encompdev\_api\_config](#input\_ltk\_encompdev\_api\_config)                     | CPU and memory configuration for the ltk-encompdev-api application       | <pre>object({<br>    container_cpu    = number<br>    task_cpu         = number<br>    container_memory = number<br>    task_memory      = number<br>})</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | <pre>{<br>  "container_cpu": 256<br>  "task_cpu": 256<br>  "container_memory": 512<br>  "task_memory": 512<br>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |    no    |
| <a name="input_ltk_ai_public_licensing_config"></a> [ltk\_ai\_public\_licensing\_config](#input\_ltk\_ai\_public\_licensing\_config) | CPU and memory configuration for the ltk-ai-public-licensing application | <pre>object({<br>    container_cpu    = number<br>    task_cpu         = number<br>    container_memory = number<br>    task_memory      = number<br>})</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | <pre>{<br>  "container_cpu": 256<br>  "task_cpu": 256<br>  "container_memory": 512<br>  "task_memory": 512<br>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |    no    |
| <a name="input_ltk_api_settings_config"></a> [ltk\_api\_settings\_config](#input\_ltk\_api\_settings\_config)                        | CPU and memory configuration for the ltk-api-settings application        | <pre>object({<br>    container_cpu    = number<br>    task_cpu         = number<br>    container_memory = number<br>    task_memory      = number<br>})</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | <pre>{<br>  "container_cpu": 256<br>  "task_cpu": 256<br>  "container_memory": 512<br>  "task_memory": 512<br>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |    no    |
| <a name="input_chat_with_docs_config"></a> [chat\_with\_docs\_config](#input\_chat\_with\_docs\_config)                              | CPU and memory configuration for the chat-with-docs application          | <pre>object({<br>    container_cpu    = number<br>    task_cpu         = number<br>    container_memory = number<br>    task_memory      = number<br>})</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | <pre>{<br>  "container_cpu": 256<br>  "task_cpu": 256<br>  "container_memory": 512<br>  "task_memory": 512<br>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |    no    |
| <a name="input_ltk_api_events_config"></a> [ltk\_api\_events\_config](#input\_ltk\_api\_events\_config)                              | CPU and memory configuration for the ltk-api-events application          | <pre>object({<br>    container_cpu    = number<br>    task_cpu         = number<br>    container_memory = number<br>    task_memory      = number<br>})</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | <pre>{<br>  "container_cpu": 256<br>  "task_cpu": 256<br>  "container_memory": 512<br>  "task_memory": 512<br>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |    no    |
| <a name="input_scaling_config"></a> [scaling\_config](#input\_scaling\_config)                                                       | The scaling configuration for the target.                                | <pre>object({<br>    max_capacity       = number<br>    min_capacity       = number<br>    target_value       = number<br>    scale_in_cooldown  = number<br>    scale_out_cooldown = number<br>  })</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | <pre>{<br>  "max_capacity": 10,<br>  "min_capacity": 1,<br>  "scale_in_cooldown": 300,<br>  "scale_out_cooldown": 300,<br>  "target_value": 500<br>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |    no    |
| <a name="input_environment"></a> [environment](#input\_environment)                                                                  | Full name of the environment                                             | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `""`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |   yes    |
| <a name="input_lennarmortgage_metadata_url"></a> [lennarmortgage\_metadata_url](#input\_lennarmortgage\_metadata\_url)               | Metadata URL for lennarmortgage Cognito Identity Provider                | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `""`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |   yes    |
| <a name="input_lendertoolkit_metadata_url"></a> [lendertoolkit\_metadata_url](#input\_lendertoolkit\_metadata\_url)                  | Metadata URL for lendertoolkit Cognito Identity Provider                 | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `""`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |   yes    |
| <a name="input_cognito_user_pool"></a> [cognito\_user\_pool](#input\_cognito\_user\_pool)                                            | Cognito User Pool variables for Cognito module                           | <pre>object({<br>    environment                  = string<br>    allow_admin_create_user_only = bool<br><br>    invite_message_template = object({<br>        email_message = string<br>        email_subject = string<br>        sms_message   = string<br>    })<br><br>    verification_message_template = object({<br>        default_email_option  = string<br>        email_message         = string<br>        email_message_by_link = string<br>        email_subject         = string<br>        email_subject_by_link = string<br>        sms_message           = string<br>    })<br><br>    email_configuration = object({<br>        email_configuration = string<br>    })<br><br>    user_pool_add_ons = object({<br>        advanced_security_mode = string<br>    })<br><br>    username_configuration = object({<br>        case_sensitive = bool<br>    })<br>})</pre>                                                                                                                                                                                                                                                                              | <pre>{<br>  "environment" = "",<br>  "allow_admin_create_user_only": false,<br>  "invite_message_template" = {<br>  "email_message": "",<br>   "email_subject": "",<br>   "sms_message": ""<br>  },<br>  "verification_message_template": {<br>    "default_email_option": "",<br>    "email_message": "",<br>    "email_message_by_link": "",<br>    "email_subject": "",<br>    "email_subject_by_link": "",<br>    "sms_message": ""<br>  },<br>  "email_configuration": {<br>    "email_sending_account": "",<br>  },<br>  "user_pool_add_ons": {<br>    "advanced_security_mode": ""<br>  },<br>  "username_configuration": {<br>    "case_sensitive": false<br>  }<br>}</pre> |   yes    |
| <a name="input_user_pool_clients"></a> [user\_pool\_clients](#input\_user\_pool\_clients)                                            | User Pool Client config for Cognito module                               | <pre>list(object({<br>    name                                          = string<br>    refresh_token_validity                        = string<br>    access_token_validity                         = string<br>    id_token_validity                             = string<br>    explicit_auth_flows                           = list(string)<br>    supported_identity_providers                  = list(string)<br>    callback_urls                                 = list(string)<br>    logout_urls                                   = list(string)<br>    allowed_oauth_flows                           = list(string)<br>    allowed_oauth_scopes                          = list(string)<br>    allowed_oauth_flows_user_pool_client          = bool<br>    prevent_user_existence_errors                 = string<br>    enable_token_revocation                       = bool<br>    enable_propagate_additional_user_context_data = bool<br>    auth_session_validity                         = number<br>    read_attributes                               = list(string)<br>    write_attributes                              = list(string)<br>}))</pre> | []                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |   yes    |
| <a name="input_cognito_identity_providers"></a> [cognito\_identity\_providers](#input\_cognito\_identity\_providers)                 | Identity providers for cognito module                                    | `list(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | n/a                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |   yes    |
| <a name="input_resource_server"></a> [resource\_server](#input\_resource\_server)                                                    | Resource server config for Cognito module                                | <pre>object({<br>    identifier = string<br>    name       = string<br>})</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | <pre>{<br>  "identifier": "",<br>  "name": ""<br>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |   yes    |
| <a name="input_user_groups"></a> [user\_groups](#input\_user\_groups)                                                                | User Group config for Cognito module                                     | <pre>list(object({<br>    name        = string<br>    description = string<br>    precedence  = number<br>  })<br>)</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | []                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |    no    |
| <a name="input_cognito_ses_email"></a> [cognito\_ses\_email](#input\_cognito\_ses\_email)                                            | SES email address for Cognito module                                     | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | n/a                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |   yes    |
| <a name="input_cognito_domain"></a> [cognito\_domain](#input\_cognito\_domain)                                                       | Domain for Cognito module                                                | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | n/a                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |   yes    |
| <a name="input_domain_prefix"></a> [domain\_prefix](#input\_domain\_prefix)                                                          | Domain prefix for Cognito module                                         | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | n/a                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |   yes    |
| <a name="input_thresholds"></a> [thresholds](#input\_thresholds)                                                                     | Alerting thresholds for alerts                                           | `map(any)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | <pre>{<br>  "cpu_utilization_threshold": 95<br>  "memory_threshold": 95<br>  "httpcode_5xx_count_threshold": 30<br>  "httpcode_target_5xx_count_threshold": 30<br>  "latency_threshold": 100<br>  "rejected_connection_count_threshold": 30<br>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |

## Outputs

| Name                                                                     | Description |
|--------------------------------------------------------------------------|-------------|
| <a name="output_ecs_outputs"></a> [ecs\_outputs](#output\_ecs\_outputs)  | n/a         |
<!-- END_TF_DOCS -->